---
eip: 5875
title: Opcode for TX Number
description: Add an opcode to retrieve TX number
author: Zainan Victor Zhou (@xinbenlv)
discussions-to: https://ethereum-magicians.org/t/eip-5875-opcode-for-tx-number-in-a-block/11612
status: Draft
type: Standards Track
category: Core
created: 2022-11-04
---

## Abstract

Upon `FORK_NUM_TBD`, add EVM an opcode instruction with value `OPCODE_TBD` and name `TXNUM` to retrieve TX number inside of a block.

## Motivation

A TX is an atomic point of time for world state.

Currently we have access to blocknum but there is no way to access a tx number within a smart contract.

We hereby propose a TXNUM opcode instruction to fetch TXNUM which can be used to

identify the ordering of exact transaction in its block
Better than blockNum: identifying uniquely and unambiguously the world state.
Better than txHash: allow simply arithmatic by BlockNum.TxNum
It would be helpful for on-chain and off-chain indexing and snapshotting.

An example of use-case is in snapshot weighted voting, we want to store snapshot of voting rights. The current option with with either `block.timesamp` or `block.number` all only have the granularity at the level of blocks. But world state changes across transaction. If there is any TX in the same block cause a voting right to change, the blocknum or `block.timstamp` will not be sufficient to pin-point the world state of snapshot of voting rights.

## Specification

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 and RFC 8174.

1. Parameter Table

- `FORK_NUM_TBD`: the fork block number to start introducing this change.
- `OPCODE_TBD`: the opcode value being introduced.

1. Upon `TBD_FORK_NUM`, add EVM an opcode with name `TXNUM` and value `TBD_OPCODE` instruction to retrieve TX number.

2. The returned value is in the length of `uint256`, a word length of EVM.

## Rationale

1. We choose the TX number length for a world length for simplicity.
2. While currently most block contains O(100) TXs, we didn't impose a boundary for TX number other than uint256 to allow
a future where each block can have much larger blocks.

### Further discussions needed

4. further discussion is needed about potentially bounding the TX num for simpler onchain computation if use case arises.
5. further discussion is needed about whether to use TX number within the block or globally. Globally makes it easier to compute number distaince between two TXs directly but is useless for DAG
if we foresee a DAG future.

## Backwards Compatibility

Needs discussion.

## Security Considerations

Needs discussion.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).
