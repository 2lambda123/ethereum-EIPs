---
eip: 5875
title: Opcode for transaction index
description: Add an opcode to retrieve the transaction index in a block
author: Zainan Victor Zhou (@xinbenlv)
discussions-to: https://ethereum-magicians.org/t/eip-5875-opcode-for-transaction-number-in-a-block/11612
status: Draft
type: Standards Track
category: Core
created: 2022-11-04
---

## Abstract

This EIP adds an instruction `TXINDEX` to retrieve the Transaction Index inside of a block.

## Motivation

A transaction is an atomic point of time for a world state. Currently, we have access to the block number through `BLOCKNUMBER (0x43)`, but there is no way to access the transaction index within a smart contract. This EIP adds an opcode to fetch the transaction index, which can be used to:

* Identify the exact ordering of transactions within a block
* Uniquely and unambiguously identify the world state (better than `BLOCKNUMBER`)
* Allow simple arithmetic on the Transaction Index (better than an opcode to get the transaction hash)
* On-chain and off-chain indexing and snapshotting

An example use-case is snapshot weighted voting, in which a snapshot of voting rights is generated. The current options are with `block.timesamp` or `block.number`, which only have block-level granularity. But the world state changes across transactions within a block. If there is any transaction in the same block that causes a voting right to change, the block number or block timestamp is not sufficient to pinpoint the world state of a snapshot of voting rights.

## Specification

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 and RFC 8174.

1. Parameter Table

* `FORK_NUM_TBD`: the fork block number to start introducing this change.
* `OPCODE_TBD`: the opcode value being introduced.

2. On `TBD_FORK_NUM`, a new instruction `TXINDEX (0xXX)` is introduced

3. Upon execution, the instruction pushes a value of the index of the current transaction in its block in the stack.

## Rationale

1. We choose the Transaction Index length for a world length for simplicity.
2. While currently most block contains O(100) transactions, we didn't impose a boundary for transaction index other than uint256 to allow
a future where each block can have much larger blocks.

### Further discussions needed

4. Further discussion is needed about potentially bounding the transaction index for simpler on-chain computation if use case arises.
5. Further discussion is needed about whether to use transaction index within the block or globally. Globally makes it easier to compute number distance between two transactions directly but is useless for DAG
if we foresee a DAG future.

## Backwards Compatibility

Needs discussion.

## Security Considerations

Needs discussion.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).
