---
eip: 684
title: Prevent overwriting contracts
description: Revert contract creation if account already has code
author: Vitalik Buterin (@vbuterin), Renan Rodrigues de Souza (@RenanSouza2)
discussions-to: https://ethereum-magicians.org/t/eip-684-reverto-on-address-collision/13558
status: Draft
type: Standards Track
category: Core
created: 2023-03-26
---

## Abstract

This standard defines what happens if the address in a contract creation collides with an existing contract

## Motivation

In [EIP-3607](./eip-3607.md) it was estimated to require 10 billion USD in computing power to create an address collision. This number decreases as computers become more efficient over time.

## Specification

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 and RFC 8174.

If a contract creation is attempted, due to either a creation transaction, CREATE or CREATE2 opcodes, and the destination address already has either nonzero nonce, or nonempty code, then the creation MUST throw immediately, with exactly the same behavior as would arise if the first byte in the init code were an invalid opcode. This applies retroactively starting from genesis.

## Rationale

This is the most correct approach for handling the case where a contract is created in a slot where a contract already exists, as the current behavior of overwriting contract code is highly unintuitive and dangerous.

## Backwards Compatibility

This is an execution layer upgrade, and so it required a hard fork. ALready implemented

## Test Cases

Given a genesis allocation of

```
Address : 0xd0bBEc6D2c628b7e2E6D5556daA14a5181b604C5,
Balance : 1000000000000000000, // 1 ether
Nonce   : 0,
code    : "",

Address : 0x7658771dc6Af74a3d2F8499D349FF9c1a0DF8826,
Balance : 0,
Nonce   : 1,
Code    : "0xB0B0FACE",
```

A contract created in the first transaction from EOA `0xd0bBEc6...` (`227bcc6959669226360814723ed739f1214201584b6a27409dfb8228b8be5f59`), with no salt, should revert.

## Reference Implementation

The following check MUST be included in the function create function, MUST revert in case the check fails.

```
// During the execution of the create function Λ, defined in the yellow paper
// after computing the address of the new contract 'a'

a ≡ ADDR(s, σ[s]n − 1, ζ, i)

require(σ[a]c != EMPTYCODEHASH)
```

## Security Considerations

This EIP is a security upgrade: it reinforces the imutability of a deployed code.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).
