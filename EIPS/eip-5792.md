---
eip: 5792
title: Wallet Abstract Transaction Send API
description: Adds JSON RPC methods for sending multiple function calls from a wallet and checking each bundle's status
author: Moody Salem (@moodysalem)
discussions-to: https://ethereum-magicians.org/t/eip-5792-wallet-abstract-transaction-send-api/11374
status: Draft
type: Standards Track
category: Interface
created: 2022-10-17
---

## Abstract

Defines new JSON RPC methods for dapps to send function calls, i.e. messages, from a user's wallet, as well as check
on the status of these messages. These new methods are abstracted from the underlying chain to allow for differences in
how messages are sent by the user's wallet, e.g. smart contract wallets utilizing [EIP-4337](./eip-4337.md) or EOA
wallets that support bundled transactions via [EIP-3074](./eip-3074.md). Dapps may use this more abstract interface to
support different kinds of wallets, as well as provide a better UX for sending bundles of transactions (e.g. Approve and
Call).

## Motivation

The current APIs to send transactions and check their status, `eth_sendTransaction` and `eth_getTransactionReceipt`,
are not flexible enough for dapps to provide a good transaction user experience for sending transactions and showing
their status. For example, these methods do not allow sending multiple transactions, or querying the status of a
replaced-by-fee (sped up) transaction.

This problem becomes worse with account abstracted wallets (e.g. [EIP-4337](./eip-4337.md)
or [EIP-3074](./eip-3074.md)), where the actual transaction hash may not be known at the time of signing, but must still
be returned by `eth_sendTransaction`. The transaction hash returned by `eth_sendTransaction` in these cases is unlikely
to be relevant to the actual transaction hash of the included transaction. Dapps often link to the block explorer for
the returned transaction hash, but in these cases the transaction hash is often wrong.

Dapps need a better interface for sending batches of function calls from the user's wallet so the dapp can interact with
wallets without considering the differences between wallet implementations. Some wallets may
use [EIP-3074](./eip-3074.md) to deliver batches of messages as a single transaction, whereas others may use smart
contract accounts via [EIP-4337](./eip-4337.md). Regular EOA wallets may send bundles of messages as individual
transactions.

The goal of the new interface is to be a more stable and flexible interface while wallet implementations evolve over
time.

## Specification

Three new JSON RPC methods are added. Dapps may begin using these methods immediately, falling back
to `eth_sendTransaction` and `eth_getTransactionReceipt` when they are not available.

### `wallet_sendMessageBundle`

Requests that the wallet deliver a group of messages on-chain from the user's wallet.
The wallet MAY send all the messages as a single transaction.
Dapps MUST NOT rely on the messages being sent in a single transaction, i.e. other untrusted transactions may be
included between each of the transactions.
The wallet MUST send these messages in the order specified in the request.
The wallet MUST attempt to deliver all messages if it returns a successful response to this method, and the wallet MUST
NOT deliver any messages if it returns an error response.
The wallet MAY reject the request if the chain ID does not match the currently selected chain ID.
The wallet MUST send the messages on the specified chain ID.
The wallet MUST reject the request if the `from` address does not match the enabled account.
The wallet MAY reject the request if one or more messages in the bundle will fail.

#### Parameters

The method takes an array containing one object element, with the following keys:

- `chainId`: `INTEGER` - The chain ID on which the transactions should be sent
- `from`: `ADDRESS` - The address of the wallet that should send the messages in the bundle
- `messages`: `ARRAY` - An array containing 1 or more message objects, where each message has the following keys:
    - `to`: `ADDRESS` - (optional when creating new contract) The address the message is directed to.
    - `gas`: `QUANTITY` - (optional) Integer of the gas provided for the message execution. Unused gas MAY be made
      available to subsequent messages.
    - `value`: `QUANTITY` - (optional) Integer of the value sent with this transaction.
    - `data`: `DATA` - The compiled code of a contract OR the message data to include with the call, e.g. encoded
      function signature and parameters.
    - `optional`: `BOOLEAN` - (optional, default false) Whether the wallet should continue with subsequent messages if
      this particular message fails

##### Example

```json
[
  {
    "chainId": 1,
    "from": "0xd46e8dd67c5d32be8058bb8eb970870f07244567",
    "messages": [
      {
        "to": "0xd46e8dd67c5d32be8058bb8eb970870f07244567",
        "gas": "0x76c0",
        "value": "0x9184e72a",
        "data": "0xd46e8dd67c5d32be8d46e8dd67c5d32be8058bb8eb970870f072445675058bb8eb970870f072445675",
        "optional": true
      },
      {
        "to": "0xd46e8dd67c5d32be8058bb8eb970870f07244567",
        "gas": "0xdefa",
        "value": "0x182183",
        "data": "0xfbadbaf01"
      }
    ]
  }
]
```

#### Return value

DATA, 32 Bytes - an identifier that the wallet uses to represent the bundle of messages. This identifier MUST persist
between connections of the same Dapp and account.

The dapp may track this identifier to check the status of the transaction in the future.
The returned identifier value MUST be unique for the given `from` address.
The length of the returned response MUST NOT exceed 66 characters.
There are no other requirements on the format of the identifier.

##### Example

The identifier may be the hash of the message bundle, e.g.:

```json
"0xe670ec64341771606e55d6b4ca35a1a6b75ee3d5145a99d05921026d1527331"
```

The identifier may be a numeric identifier represented as a string, e.g.:

```json
"0x01"
```

### `wallet_getBundleStatus`

Returns the status of a bundle that was sent via `wallet_sendMessageBundle`. The identifier of the bundle is the value
returned from the `wallet_sendMessageBundle` RPC. Note this method only returns a subset of fields
that `eth_getTransactionReceipt` returns, excluding any fields that may differ in meaning between wallet
implementations.

#### Parameters

The method takes an array containing one string element, a bundle ID returned by `wallet_sendMessageBundle`.

##### Example

```json
[
  "0xe670ec64341771606e55d6b4ca35a1a6b75ee3d5145a99d05921026d1527331"
]
```

#### Return value

Returns an object describing the status of each message in the bundle. Each message has its own status in the response,
even if all the messages were submitted as part of a single transaction.

- `id`: `DATA` - The identifier of the transaction returned by `wallet_sendMessageBundle`
- `messages`: `ARRAY` - An array of objects containing the status of each message from the bundle
    - `status`: `"PENDING" | "CONFIRMED"` - Either `"PENDING"` indicating the message is not yet included on-chain,
      or `"CONFIRMED"` indicating the message was included in a block
    - `receipt`: `OBJECT` - (optional) An object containing the receipt for the given message, _iff_ status
      is `"CONFIRMED"`
        - `logs`: `ARRAY` - An array of log objects describing logs that were emitted by the message
        - `success`: `BOOLEAN` - Whether the message was successfully delivered on-chain
        - `blockHash`: `DATA` - The hash of the block in which the message was sent
        - `blockNumber`: `QUANTITY` - The block number of the block in which the message was sent
        - `blockTimestamp`: `QUANTITY` - The block timestamp of the block in which the message was sent
        - `transactionHash`: `DATA` - The hash of the transaction in which the message was sent
        - `gasUsed`: `QUANTITY` - The amount of gas that the message cost to deliver

##### Example

```json
{
  "id": "0xe670ec64341771606e55d6b4ca35a1a6b75ee3d5145a99d05921026d1527331",
  "messages": [
    {
      "status": "CONFIRMED",
      "receipt": {
        "logs": [
          {
            "address": "0xa922b54716264130634d6ff183747a8ead91a40b",
            "topics": [
              "0x5a2a90727cc9d000dd060b1132a5c977c9702bb3a52afe360c9c22f0e9451a68"
            ],
            "data": "0xabcd"
          }
        ],
        "success": true,
        "blockHash": "0xf19bbafd9fd0124ec110b848e8de4ab4f62bf60c189524e54213285e7f540d4a",
        "blockNumber": "0xabcd",
        "blockTimestamp": "0xabcdef",
        "gasUsed": "0xdef",
        "transactionHash": "0x9b7bb827c2e5e3c1a0a44dc53e573aa0b3af3bd1f9f5ed03071b100bb039eaff"
      }
    },
    {
      "status": "PENDING"
    }
  ]
}
```

### `wallet_showBundleStatus`

Requests that the wallet present UI showing the status of the given bundle. This allows dapps to delegate the
display of the transaction status to the wallet, which can most accurately render the current status of the bundle.
The wallet MAY ignore the request, for example if the wallet is busy with other user actions.
The wallet MAY direct the user to a block explorer for more information.
This RPC is intended to replace the typical user experience of a dapp linking to a block explorer.

#### Parameters

The method takes an array containing one string element, a bundle ID returned by `wallet_sendMessageBundle`.

##### Example

```json
[
  "0xe670ec64341771606e55d6b4ca35a1a6b75ee3d5145a99d05921026d1527331"
]
```

#### Return value

This method always returns `null`.

##### Example

```json
null
```

## Rationale

Account abstracted wallets, either via [EIP-3074](./eip-3074.md) or [EIP-4337](./eip-4337.md) or other specifications,
have more capabilities than regular EOA accounts.

The `eth_sendTransaction` and `eth_getTransactionReceipt` methods limit the quality of in-dapp transaction
construction and status tracking. It's possible for dapps to stop tracking transactions altogether and
leave that UX to the wallet, but it is a better UX when dapps provide updates on transactions constructed within the
dapp, because dapps will always have more context than the wallets on the action that a set of messages is
meant to perform. For example, an approve and swap might both be related to a trade that a user is attempting to make.
Without these APIs, it's necessary for a dapp to represent those actions as individual transactions.

## Backwards Compatibility

Wallets that do not support the following methods should return error responses to the new JSON RPC methods indicating
as such.
Dapps MAY attempt to send the same bundle of messages via `eth_sendTransaction` when they receive a failure message.

## Security Considerations

Dapp developers MUST treat each message in a bundle as if it were an independent transactions. In other words, there may
be additional untrusted transactions between any of the messages in a bundle. The messages in the bundle may also be
included in separate blocks.
Dapp developers MUST NOT assume that all messages are sent in a single transaction.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).
