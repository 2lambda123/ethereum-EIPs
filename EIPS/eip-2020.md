---
eip: 2020
title: Ethereum Provider API
author: Ryan Ghods (@ryanio), Marc Garreau (@marcgarreau)
discussions-to: https://ethereum-magicians.org/t/eip-2020-ethereum-provider/640
status: Draft
type: Standards Track
category: Interface
created: 2018-06-30
requires: 1102
---

## Summary

This proposal formalizes an Ethereum Provider API.

## API

```js
// Ethereum JSON-RPC API requests
// https://github.com/ethereum/wiki/wiki/JSON-RPC
ethereum.send(method: String, params: Array<any>): Promise<any>;

// Subscriptions (RPC pub-sub)
// https://github.com/ethereum/go-ethereum/wiki/RPC-PUB-SUB
ethereum.on(subscriptionType: String, listener: (response: any) => void): Promise<String>;

// EventEmitter
// https://nodejs.org/api/events.html
ethereum.on('connect', listener: () => void): this;
ethereum.on('close', listener: (code: Number, reason: String) => void): this;
ethereum.on('networkChanged', listener: (networkId: String) => void): this;
ethereum.on('accountsChanged', listener: (accounts: Array<String>) => void): this;

// Class
ethereum.constructor.name;
> 'EthereumProvider'
```

## Examples

```js
// Request Ethereum Provider (EIP 1102)
window.addEventListener('message', function(event) {
  if (event.data && event.data.type === 'ETHEREUM_PROVIDER_SUCCESS') {
    start(event.data.ethereum);
  }
});
window.postMessage({ type: 'ETHEREUM_PROVIDER_REQUEST' });

function start(ethereum) {
  // Set provider in web3.js
  web3.setProvider(ethereum);

  // Log accounts
  ethereum
    .send('eth_accounts', [])
    .then(result => {
      console.log(
        `Accounts:\n
         ${result.accounts.join('\n')}`
      );
    })
    .catch(error => {
      console.error(
        `Error fetching accounts:\n
         Code: ${error.code}\n
         Message: ${error.message}\n
         Data: ${error.data}`
      );
    });

  // Log latest blocks
  let subscriptionId;
  ethereum
    .on('newHeads', response => {
      if (response.error) {
        console.error(
          `Error from newHeads subscription ${subscriptionId}:\n
           Code: ${response.error.code}\n
           Message: ${response.error.message}\n
           Data: ${response.error.data}`
        );
      } else {
        console.log(`New block: ${response.result}`);
      }
    })
    .then(id => {
      subscriptionId = id;
    })
    .catch(error => {
      console.error(
        `Error creating new block subscription:\n
         Code: ${error.code}\n
         Message: ${error.message}\n
         Data: ${error.data}`
      );
    });
  // to unsubscribe
  ethereum
    .send('eth_unsubscribe', [subscriptionId])
    .then(result => {
      console.log(`Unsubscribed newHeads subscription ${subscriptionId}`);
    })
    .catch(error => {
      console.error(
        `Error unsubscribing newHeads subscription ${subscriptionId}:\n
         Code: ${error.code}\n
         Message: ${error.message}\n
         Data: ${error.data}`
      );
    });

  // Log accounts if changed
  const accountsCallback = accounts => {
    console.log(
      `Accounts:\n
       ${accounts.join('\n')}`
    );
  };
  ethereum.on('accountsChanged', accountsCallback);
  // to unsubscribe
  accountsEmitter.removeListener('accountsChanged', accountsCallback);

  // Log if connection ends
  ethereum.on('close', (code, reason) => {
    console.error(
      `Ethereum provider connection closed:\n
       Code: ${code}\n
       Reason: ${reason}`
    );
  });
}
```

## Specification

### Send

If the Ethereum JSON-RPC API returns a response object with no error, then the Promise **MUST** resolve with the `response.result` object untouched by the implementing Ethereum Provider.

If the Ethereum JSON-RPC API returns response object that contains an error property then the Promise **MUST** be rejected with an Error object containing the `response.error.message` as the Error message, `response.error.code` as a code property on the error and `response.error.data` as a data property on the error.

If an error occurs during processing, such as an HTTP error or internal parsing error then the Promise **MUST** be rejected with an Error object containing a human readable string message describing the error and **SHOULD** populate code and data properties on the error object with additional error details.

If the implementing Ethereum Provider is not talking to an external Ethereum JSON-RPC API provider then it **MUST** resolve with an object that matches the JSON-RPC API object as specified in the [Ethereum JSON-RPC documentation](https://github.com/ethereum/wiki/wiki/JSON-RPC). In case of an error, ensure that the Promise is rejected with an Error that matches the above shape.

### Subscriptions

The implementing Ethereum Provider **MUST** create a subscription using `eth_subscribe` with `subscriptionType` and **MUST** return a Promise that resolves with the subscriptionId as a `String`.

The implementing Ethereum Provider **MUST** return any response to the `listener` callback untouched.

If an error occurs during processing, such as an HTTP error or internal parsing error then the listener **MUST** return with an Error object containing a human readable string message describing the error and **SHOULD** populate code and data properties on the error object with additional error details.

### Events

If the network connects, the Ethereum Provider **MUST** emit an event named `connect`.

If the network connection closes, the Ethereum Provider **MUST** emit an event named `close` with args `code: Number, reason: String` following the [list of status codes for `CloseEvent`](https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent) and a short human-readable string of the reason.

If the network the Ethereum Provider is connected to changes, the Ethereum Provider **MUST** emit an event named `networkChanged` with args `networkId: String` containing the ID of the new network (using the Ethereum JSON-RPC call `net_version`).

If the accounts connected to the Ethereum Provider change, the Ethereum Provider **MUST** send an event with the name `accountsChanged` with args `accounts: Array<String>` containing the accounts' public key(s).

### Class

The name of the constructor of the Ethereum Provider **MUST** be `EthereumProvider`.

## Topics

### Multiple chain support

As per discussion in [ethereum/interfaces#16](https://github.com/ethereum/interfaces/issues/16), to handle support of changing networks we recommend introducing a new RPC method `eth_changeNetwork`. In the future depending on the implementation of sharding, an additional method could be `eth_changeShard`.

### Against polluting the global namespace

Previously, web3 clients have injected their own web3 libraries into the global namespace. This leads to issues like outdated libraries and breaking changes. We can supply the provider along with the return event of the postMessage request and prevent polluting the global namespace, with the benefit of protecting against fingerprinting attacks (see [EIP 1102](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1102.md)). Apps should version their own web3 library, then simply set the provider after receiving it (e.g. `web3.setProvider()`).

## Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
