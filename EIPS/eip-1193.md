---
eip: 1193
title: Ethereum Provider JavaScript API
author: Fabian Vogelsteller (@frozeman), Ryan Ghods (@ryanio), Victor Maia (@MaiaVictor), Marc Garreau (@marcgarreau)
discussions-to: https://github.com/ethereum/EIPs/issues/2319
status: Draft
type: Standards Track
category: Interface
created: 2018-06-30
requires: 155, 695, 1102, 1474
---

## Summary

This EIP specifies an Ethereum Provider JavaScript API for consistency across clients and applications.
The Provider is designed to be minimal and intended to be available as `window.ethereum` for cross-environment compatibility.

## API

### request

Makes a JSON-RPC method call.

```typescript
ethereum.request(method: string, params?: Array<any>): Promise<unknown>;
```

The Promise resolves the method's result or rejects with an `Error`. For example:

```js
ethereum.request('eth_accounts')
.then(accounts => console.log(accounts))
.catch(error => console.error(error))
```

Consult each RPC method's documentation for its return type.
You can find a list of common Ethereum JSON-RPC methods [here](https://github.com/ethereum/wiki/wiki/JSON-RPC#json-rpc-api-reference).

The Promise rejects with errors of the following form:

```typescript
{
  message: string,
  code: number,
  data?: any
}
```

See the [JSON-RPC Errors](#json-rpc-errors) section for more details.

### sendAsync (DEPRECATED)

Submits a JSON-RPC request to the Provider.
As [`ethereum.request`](#request), but with a callback and JSON-RPC objects.

```typescript
ethereum.sendAsync(request: Object, callback: Function): Object;
```

The interfaces of request and response objects are not specified here.
Historically, they have followed the [Ethereum JSON-RPC specification](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1474.md).

### send (DEPRECATED)

Due to conflicting implementations and specifications, this method is unreliable and should not be used.

```typescript
ethereum.send(...args: Array<any>): unknown;
```

### Events

Events follow the [Node.js `EventEmitter`](https://nodejs.org/api/events.html) API.

#### notification

The Provider emits `notification` upon receipt of a JSON-RPC notification intended for the dapp.

```typescript
interface JsonRpcNotification {
  method: string,
  params: Array<unknown> | Object,
  jsonrpc?: '2.0'
}

ethereum.on('notification', listener: (notification: JsonRpcNotification) => void): ethereum;
```

Notifications include `eth_subscription` messages, if supported by the Provider. See [here](https://geth.ethereum.org/docs/rpc/pubsub) for details.

#### connect

The Provider emits `connect` when it becomes connected. This includes:

- when the Provider first connects to a chain after being initialized
- when the Provider connects to a chain, after the `close` event was emitted

```typescript
interface ConnectInfo {
  chainId: number,
  ...props?: Array<unknown>
}

ethereum.on('connect', listener: (connectInfo: ConnectInfo) => void): ethereum;
```

The event emits an object with a `chainId` property per the `eth_chainId` Ethereum JSON-RPC method, and other properties as determined by the Provider.

#### close

The Provider emits `close` when it becomes disconnected from all chains.

```typescript
ethereum.on('close', listener: (code: number, reason: string) => void): ethereum;
```

This event emits with `code` and `reason`. The code follows the table of [`CloseEvent` status codes](https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent#Status_codes).

#### chainChanged

The Provider emits `chainChanged` when connecting to a new chain.

```typescript
ethereum.on('chainChanged', listener: (chainId: number) => void): ethereum;
```

The event emits an integer `chainId` per the `eth_chainId` Ethereum JSON-RPC method.

#### networkChanged (DEPRECATED)

The event `networkChanged` is deprecated in favor of `chainChanged`. For details, see [EIP 155: Simple replay attack protection](https://eips.ethereum.org/EIPS/eip-155) and [EIP 695: Create eth_chainId method for JSON-RPC](https://eips.ethereum.org/EIPS/eip-695).

#### accountsChanged

The Provider emits `accountsChanged` if the accounts returned from the Provider (`eth_accounts`) change.

```typescript
ethereum.on('accountsChanged', listener: (accounts: Array<string>) => void): ethereum;
```

The event emits with `accounts`, an array of account addresses.

## Examples

```js
const ethereum = window.ethereum;

// A) Set Provider in web3.js
var web3 = new Web3(ethereum);
// web3.eth.getBlock('latest', true).then(...)

// B) Use Provider object directly
// Example 1: Log last block
ethereum
  .request('eth_getBlockByNumber', ['latest', 'true'])
  .then(block => {
    console.log(`Block ${block.number}:`, block);
  })
  .catch(error => {
    console.error(
      `Error fetching last block: ${error.message}.
       Code: ${error.code}. Data: ${error.data}`
    );
  });

// Example 2: Log available accounts
ethereum
  .request('eth_accounts')
  .then(accounts => {
    console.log(`Accounts:\n${accounts.join('\n')}`);
  })
  .catch(error => {
    console.error(
      `Error fetching accounts: ${error.message}.
       Code: ${error.code}. Data: ${error.data}`
    );
  });

// Example 3: Log new blocks
ethereum
  .request('eth_subscribe', ['newHeads'])
  .then(subscriptionId => {

    ethereum.on('notification', notification => {

      if (notification.method === 'eth_subscription') {

        const { params } = notification;

        if (params.subscription === subscriptionId) {

          if (typeof params.result === 'string' && params.result) {

            const block = params.result;
            console.log(`New block ${block.number}:`, block);

          } else {
            console.error(`Something went wrong: ${params.result}`);
          }
        }
      }
    });
  })
  .catch(error => {
    console.error(
      `Error making newHeads subscription: ${error.message}.
       Code: ${error.code}. Data: ${error.data}`
    );
  });

// Example 4: Log when accounts change
const logAccounts = accounts => {
  console.log(`Accounts:\n${accounts.join('\n')}`);
};
ethereum.on('accountsChanged', logAccounts);
// to unsubscribe
ethereum.removeListener('accountsChanged', logAccounts);

// Example 5: Log if connection ends
ethereum.on('close', (code, reason) => {
  console.log(`Ethereum Provider connection closed: ${reason}. Code: ${code}`);
});
```

## Specification

### Availability

If in a browser environment, the Provider **MUST** be made available as the `ethereum` property on the global `window` object.

If in a non-browser environment, the Provider **SHOULD** be made available as the `ethereum` property on the `globalThis` object.

### API

The Provider **MUST** expose the API defined in this section.
The Provider **MAY** expose other methods and properties.

#### request

> This section suggests the existence of an _internal remote procedure call_ for each call to the `request` method.
This suggestion is non-normative. For example, the return value of some RPC method may be cached locally, and directly resolved.

```typescript
Provider.request(method: string, params?: Array<any>): Promise<unknown>;
```

The `request` method is intended as a convenient wrapper for remote procedure calls.

The `request` method **MUST** handle RPC requests such that, for a given set of arguments, the returned Promise either resolves a value per the RPC method's specification, or rejects with an error.

If the returned Promise resolves, it **MUST** resolve result per the RPC method's specification.
The Promise **MUST NOT** resolve a JSON-RPC response object, unless the RPC method's return type is so defined by its specification.

If the returned Promise rejects, it **SHOULD** reject with an `Error` of the form specified in the [JSON-RPC Errors](#json-rpc-errors) section below.

The returned Promise **MUST** reject if any of the following conditions are met:

- The _internal remote procedure call_ returns an error
  - If the original error is compatible with the `EthereumJsonRpcError` interface, the Promise **SHOULD** reject with the original error
- The _internal remote procedure call_ fails for any reason
- The request requires access to an unauthorized account, per [EIP 1102](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1102.md)
  - In this case, the Promise rejection error `code` **MUST** be `4100`

#### Supported JSON-RPC Methods

Providers **SHOULD** support all methods in the [Ethereum JSON-RPC specification](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1474.md).

Any supported method that is included in the Ethereum JSON-RPC specification **MUST** follow the Ethereum JSON-RPC API specification.

If an Ethereum JSON-RPC method is not supported, it **SHOULD** be rejected with an appropriate error per the [Ethereum JSON-RPC Specification](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1474.md#error-codes).

Providers **MAY** support JSON-RPC methods not specified by the Ethereum JSON-RPC API.

#### JSON-RPC Errors

```typescript
interface EthereumJsonRpcError extends Error {
  message: string,
  code: number,
  data?: any
}
```

- `message`
  - **MUST** be a human-readable string
  - **SHOULD** adhere to the specifications in the [Error Standards](#error-standards) section below
- `code`
  - **MUST** be an integer number
  - **SHOULD** adhere to the specifications in the [Error Standards](#error-standards) section below
- `data`
  - **SHOULD** contain any other useful information about the error

##### Error Standards

`EthereumJsonRpcError` codes and messages **SHOULD** follow these conventions, in order of priority:

1. The errors in the [Provider Errors](#provider-errors) section below

2. The [Ethereum JSON-RPC API error codes](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1474.md#error-codes)

3. The [`CloseEvent` status codes](https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent#Status_codes)

#### Provider Errors

| Status code | Name                         | Description                                                              |
| ----------- | ---------------------------- | ------------------------------------------------------------------------ |
| 4001        | User Rejected Request        | The user rejected the request.                                           |
| 4100        | Unauthorized                 | The requested method and/or account has not been authorized by the user. |
| 4200        | Unsupported Method           | The requested method is not supported by the given Ethereum Provider.    |

### Events

The Provider **SHOULD** extend the [Node.js `EventEmitter`](https://nodejs.org/api/events.html) to provide dapps flexibility in listening to events. In place of full `EventEmitter` functionality, the Provider **MAY** provide as many methods as it can reasonably provide, but **MUST** provide at least `on`, `emit`, and `removeListener`.

#### notification

The Provider **MAY** emit the `notification` event, for any reason.

If the Provider supports subscription JSON-RPC methods, e.g. [`eth_subscribe`](https://geth.ethereum.org/docs/rpc/pubsub), the Provider **MUST** emit the `notification` event when it receives a subscription notification.

When emitted, the `notification` event **MUST** be emitted with an object argument of the following form:

```typescript
interface JsonRpcNotification {
  method: string,
  params: Array<unknown> | Object,
  jsonrpc?: '2.0'
}
```

#### connect

If the Provider becomes connected to a chain, the Provider **MUST** emit an event named `connect`.

The Provider "becomes connected" when:

- it first connects to a chain after initialization
- it connects to a chain after the `close` event was emitted

This event **MUST** be emitted with an object of the following form:

```typescript
interface ConnectInfo {
  chainId: number,
  ...props?: Array<unknown>
}
```

`chainId` **MUST** specify the integer ID of the connected chain, the [`eth_chainId`](https://eips.ethereum.org/EIPS/eip-695) Ethereum JSON-RPC method.

#### close

If the Provider becomes disconnected from all chains, the Provider **MUST** emit an event named `close` with arguments `code: number, reason: string` following the [status codes for `CloseEvent`](https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent#Status_codes).

#### chainChanged

If the chain the Provider is connected to changes, the Provider **MUST** emit an event named `chainChanged` with argument `chainId: number`, specifying the integer ID of the new chain, per the [`eth_chainId`](https://eips.ethereum.org/EIPS/eip-695) Ethereum JSON-RPC method.

#### accountsChanged

If the accounts available to the Provider change, the Provider **MUST** emit an event with the name `accountsChanged` with argument `accounts: Array<string>`, containing the account addresses.

The "accounts available to the Provider" are defined as whatever is returned by the `eth_accounts` Ethereum JSON-RPC method.

## Example Implementation

```js
class EthereumProvider extends EventEmitter {

  constructor() {

    super();

    // Init storage
    this._nextJsonRpcId = 0;
    this._promises = {};

    // Emit the connect event
    this._connect();

    // Listen for jsonrpc responses
    window.addEventListener('message', this._handleJsonRpcMessage.bind(this));
  }

  /* Methods */

  request(method, params = []) {
    if (!method || typeof method !== 'string') {
      return new Error('Method is not a valid string.');
    }

    if (!(params instanceof Array)) {
      return new Error('Params is not a valid array.');
    }

    const id = this._nextJsonRpcId++;
    const jsonrpc = '2.0';
    const payload = { jsonrpc, id, method, params };

    const promise = new Promise((resolve, reject) => {
      this._promises[payload.id] = { resolve, reject };
    });

    // Send jsonrpc request to Mist
    window.postMessage(
      { type: 'mistAPI_ethereum_provider_write', message: payload },
      targetOrigin
    );

    return promise;
  }

  /* Internal methods */

  _handleJsonRpcMessage(event) {
    // Return if no data to parse
    if (!event || !event.data) {
      return;
    }

    let data;
    try {
      data = JSON.parse(event.data);
    } catch (error) {
      // Return if we can't parse a valid object
      return;
    }

    // Return if not a jsonrpc response
    if (!data || !data.message || !data.message.jsonrpc) {
      return;
    }

    const message = data.message;
    const { id, method, error, result } = message;

    if (typeof id !== 'undefined') {
      const promise = this._promises[id];
      if (promise) {
        // Handle pending promise
        if (data.type === 'error') {
          promise.reject(message);
        } else if (message.error) {
          promise.reject(error);
        } else {
          promise.resolve(result);
        }
        delete this._promises[id];
      }
    } else {
      if (method && method.indexOf('_subscription') > -1) {
        // Emit subscription notification
        this._emitNotification(message);
      }
    }
  }

  /* Connection handling */

  _connect() {
    // Send to Mist
    window.postMessage(
      { type: 'mistAPI_ethereum_provider_connect' },
      targetOrigin
    );

    // Reconnect on close
    this.once('close', this._connect.bind(this));
  }

  /* Events */

  _emitNotification(notification) {
    this.emit('notification', notification);
  }

  _emitConnect() {
    this.emit('connect');
  }

  _emitClose(code, reason) {
    this.emit('close', code, reason);
  }

  _emitChainChanged(chainId) {
    this.emit('chainChanged', chainId);
  }

  _emitAccountsChanged(accounts) {
    this.emit('accountsChanged', accounts);
  }

  /**
   * DEPRECATED
   * For backwards compatibility only.
   */
  sendAsync(payload, callback) {
    return this.request(payload.method, payload.params)
      .then(result => {
        const response = payload;
        response.result = result;
        callback(null, response);
      })
      .catch(error => {
        callback(error, null);
        console.error(
          `Error from EthereumProvider sendAsync ${payload}: ${error}`
        );
      });
  }
}
```

## References

- [Initial discussion in `ethereum/interfaces`](https://github.com/ethereum/interfaces/issues/16)
- [Ethereum Magicians thread](https://ethereum-magicians.org/t/eip-1193-ethereum-provider-javascript-api/640)
- [EIP 1474](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1474.md)
- [EIP 695](https://eips.ethereum.org/EIPS/eip-695.md)
- [JSON-RPC 2.0 Specification](https://www.jsonrpc.org/specification)

## Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
