---
eip: 6963
title: Event-Driven Discovery of Wallet Providers
description: Using JavaScript `window` events to facilitate discovery of Wallet Providers by Dapps
author: Pedro Gomes (@pedrouid), Kosala Hemachandra (@kvhnuke), Richard Moore (@ricmoo), Gregory Markou (@GregTheGreek), Kyle Den Hartog (@kdenhartog), Glitch (@glitch-txs), Jake Moxey (@jxom), Pierre Bertet (@bpierre), Darryl Yeo (@darrylyeo), Yaroslav Sergievsky (@everdimension)
discussions-to: https://ethereum-magicians.org/t/eip-6963-multi-injected-provider-discovery/14076
status: Last Call
last-call-deadline: 2023-10-10
type: Standards Track
category: Interface
created: 2023-05-01
requires: 1193
---

## Abstract

Using JavaScript `window` events as an alternative discovery mechanism to [EIP-1193][EIP-1193] Provider Objects injected to `window.ethereum`, enabling Dapps to discover and interact with multiple Wallet Providers in the same webpage session.

## Motivation

Currently, many Wallet Providers offer a browser extension that injects an [EIP-1193][EIP-1193] Provider Object to the global JavaScript variable `window.ethereum`; however, this creates conflicts for users that have more than one browser extension installed.

In a given webpage session, browser extensions may be loaded in an unpredictable and unstable order, resulting in a race condition where the [EIP-1193][EIP-1193] Provider Object at `window.ethereum` is overwritten. Thus, a given Wallet Provider may not be available to a Dapp via `window.ethereum` at all times; instead, the last Wallet Provider to execute its injected content script usually "wins".

This not only results in a degraded user experience but also presents a barrier to entry for new Wallet Providers, as users are forced to activate or install only one browser extension at a time.

Some browser extensions attempt to counteract this problem by delaying their write to `window.ethereum`, which creates an unfair competition for Wallet Providers and hinders interoperability.

In this proposal, we present a solution to reduce barriers to entry for new Wallet Providers, foster fairer competition and interoperability between multiple Wallet Providers, and enhance the user experience for Dapps on Ethereum networks by allowing users to freely select their Wallet Provider of choice.

This is achieved through a set of standardized JavaScript `window` events, establishing a two-way communication protocol between client-side Ethereum libraries used by Dapps and content scripts injected by browser extensions.

## Specification

The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in [RFC-2119].

### Definitions

Wallet Provider: A user agent that manages keys and facilitates transactions with Ethereum.

[EIP-1193][EIP-1193] Provider Object: an object that conforms to [EIP-1193][EIP-1193], exposing web3 platform APIs offered by a Wallet Provider to a Dapp.

Decentralized Application (Dapp): A webpage that relies upon web3 platform APIs from EIP-1193 Provider Object(s), which are exposed to the webpage by one or more Wallet Providers.

Wallet Provider Discovery Library: A library or piece of software that enables a Dapp to discover and interact with one or more Wallet Providers.

### Wallet Provider info

An [EIP-6963][EIP-6963] compliant Wallet Provider MUST announce itself with an `Eip6963ProviderInfo` object. The following values in the `Eip6963ProviderInfo` interface MUST be included within the object:

- **`uuid`** - a [UUIDv4][RFC-4122] compliant globally unique identifier for the Wallet Provider. The cryptographic uniqueness provided by [UUIDv4][RFC-4122] guarantees that any two `Eip6963ProviderInfo` objects discovered by the Dapp during the lifetime of the page can be uniquely identified, even if other properties (defined below) match.
- **`name`** - a human-readable local alias of the Wallet Provider to be displayed to the user by the Dapp. (e.g. `Example Wallet Extension` or `Awesome Example Wallet`)
- **`icon`** - a [URI][RFC-3986] referencing an image to represent the Wallet Provider. The image SHOULD be a square with 96x96px minimum resolution. See [Icon images](#icon-images) below for additional requirements.
- **`rdns`** - a registered domain name from the Domain Name System associated with the Wallet Provider, in reverse domain name notation (e.g `com.example.subdomain`). It is RECOMMENDED this identifier remain the same throughout the development of the Wallet Provider. See [RDNS identifiers](#rdns-identifiers) below for additional requirements.

```typescript
/**
 * The information needed for a Dapp to identify and display a Wallet Provider
 */
interface Eip6963ProviderInfo {
  uuid: string;
  name: string;
  icon: string;
  rdns: string;
}
```

The `Eip6963ProviderInfo` object MAY also be extended with additional properties. If a Dapp does not recognize the additional properties, it SHOULD ignore them.

#### Icon images

The `icon` string MUST be a data URI as defined in [RFC-2397]. The image SHOULD be a square with a minimum resolution of 96x96px. The image format is RECOMMENDED to be either lossless or vector-based such as PNG, WebP or SVG to make it easily renderable by the Dapp.

URI-encoded images are flexible and allow for multiple protocols for fetching and rendering icons, for example:

```sh
# SVG (data URI)
data:image/svg+xml,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 32 32"><circle fill="red" cx="16" cy="16" r="12"/></svg>
# PNG (data URI)
data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==
```

Since SVG images can execute JavaScript, Dapps and Wallet Provider Discovery Libraries MUST render SVG images using the `<img>` tag to ensure no untrusted JavaScript execution can occur.

#### RDNS identifiers

The `rdns` (reverse-DNS) property serves as an identifier which Dapps can rely on to be stable between page sessions. The Reverse Domain Name Notation is chosen to prevent namespace collisions. The domain should be controlled by the Wallet Provider and be followed by a subdomain or a product name. Example: `com.example.MyBrowserWallet`.

- The `rdns` value MUST BE a valid [RFC-1034] Domain Name;
- The domain part of the `rdns` value SHOULD be an active domain controlled by the Wallet Provider;
- Dapps MAY reject Wallet Providers which do not follow the Reverse-DNS convention correctly;
- Dapps SHOULD NOT use the `rnds` value for feature detection, as these are self-attested and prone to impersonation or bad incentives without an additional verification mechanism; feature-discovery and verification are both out of scope of this interface specification.

Note that similar to a user agent string in browsers, the supplied value may be unknown, invalid, incorrect, or attempt to spoof a domain associated with a different Wallet Provider. Therefore, the Dapp SHOULD be able to handle these failure cases with minimal degradation to functionality.

### Wallet Provider announcement detail

The `Eip6963ProviderDetail` interface composes a Wallet Provider's display information and [EIP-1193][EIP-1193] Provider Object into a single object to be announced by the Wallet Provider. The `Eip6963ProviderDetail` MUST contain an `info` object (described by `Eip6963ProviderInfo`) and a `provider` object (`Eip1193Provider`) defined by [EIP-1193][EIP-1193].

```typescript
interface Eip6963ProviderDetail {
  info: Eip6963ProviderInfo;
  provider: Eip1193Provider;
}
```

### Events

Each Dapp and Wallet Provider are expected to emit an event and instantiate an event listener. This forms an event-driven concurrency loop that efficiently facilitates Wallet Provider discovery without namespace collisions.

There are two event interfaces used by the Dapp and Wallet to discover each other. Since the Dapp code and Wallet Provider code aren't guaranteed to run in a particular order, the events are designed to handle such race conditions.

#### Dispatching/observing events

Both Dapps and Wallet Providers MUST use the `window.dispatchEvent()` function to emit events and MUST use the `window.addEventListener()` function to observe events.

#### Wallet Provider: `eip6963:announceProvider` event

The `Eip6963AnnounceProviderEvent` MUST be a `CustomEvent` object with a `type` property containing a string value of `"eip6963:announceProvider"` and a `detail` property with an object value of type `Eip6963ProviderDetail`. The `Eip6963ProviderDetail` object SHOULD be frozen with `Object.freeze()`.

```typescript
// "Announce" event dispatched by a Wallet Provider
interface Eip6963AnnounceProviderEvent extends CustomEvent {
  type: "eip6963:announceProvider";
  detail: Eip6963ProviderDetail;
}
```

#### Dapp: `eip6963:requestProvider` event

The `Eip6963RequestProviderEvent` MUST be an `Event` object with a `type` property containing a string value of `"eip6963:requestProvider"`.

```typescript
// "Request" event dispatched by a Dapp
interface Eip6963RequestProviderEvent extends Event {
  type: "eip6963:requestProvider";
}
```

### Event loop

The Wallet Provider MUST announce the `eip6963:announceProvider` event to the Dapp via the `window.dispatchEvent()` method. The Wallet Provider MUST add an event listener to catch an `eip6963:requestProvider` event dispatched from the Dapp. This event listener MUST use a handler that will re-dispatch an `eip6963:announceProvider` event.

This re-announcement by the Wallet Provider is necessary in case the first announcement is delayed or fired before the Dapp has a chance to initialize its event listener.

The Wallet Provider dispatches the `eip6963:announceProvider` event with immutable contents and listens to the `eip6963:requestProvider` event:

```typescript
let info: Eip6963ProviderInfo;
let provider: Eip1193Provider;

const announceEvent: Eip6963AnnounceProviderEvent = new CustomEvent(
  "eip6963:announceProvider",
  { detail: Object.freeze({ info, provider }) }
);

// The Wallet Provider dispatches an `eip6963:announceProvider` event
// which is heard by the Dapp's event listener (initialized earlier)
window.dispatchEvent(announceEvent);

// The Wallet Provider listens for `eip6963:requestProvider` events (which may be dispatched at any later time)
// and in turn re-dispatches the `eip6963:announceProvider` event
window.addEventListener("eip6963:requestProvider", () => {
  window.dispatchEvent(announceEvent);
});
```

The Dapp MUST listen for the `eip6963:announceProvider` event dispatched by the Wallet via the `window.addEventListener()` method and MUST NOT remove the event listener for the lifetime of the page session in order to continue handling events beyond the initial page load interaction. The Dapp MUST dispatch the `eip6963:requestProvider` event via the `window.dispatchEvent()` method after the `eip6963:announceProvider` handler has been initialized.

```typescript
// The Dapp listens for announced Wallet Providers
window.addEventListener(
  "eip6963:announceProvider",
  (event: Eip6963AnnounceProviderEvent) => {}
);

// The Dapp dispatches a `eip6963:requestProvider` event
// which is heard by Wallet Provider's event listener (initialized earlier)
window.dispatchEvent(new Event("eip6963:requestProvider"));
```

The Dapp MAY elect to persist the `Eip6963ProviderDetail` objects from `eip6963:announceProvider` events sent by multiple Wallet Providers. Thus, if the user wishes to utilize a different Wallet Provider within the same page session, the user can express this intent within the Dapp's interface, and the Dapp can immediately elect to send transactions to the newly-chosen Wallet Provider. Additionally, the Dapp MAY re-initiate the Wallet Provider discovery flow at any time by dispatching a new `eip6963:requestProvider` event, potentially discovering a different set of Wallet Providers.

## Rationale

The previous proposal ([EIP-1193][EIP-1193]) introduced mechanisms that relied on a single, mutable `window.ethereum` object that could be overwritten by multiple parties. To avoid race conditions, namespace collisions, and potential "pollution" attacks on a shared mutable object, we opted for an event-based approach that facilitates a bidirectional communication channel between Wallet Provider and Dapp that can be re-orchestrated multiple times within a browser session.

The orchestration of events described above guarantees that the Dapp is able to discover the Wallet Provider, regardless of whether the Wallet Provider code or the Dapp code executes first. Additionally, multiple Wallet Providers can respond to requests from a single Dapp without polluting the `window.ethereum` namespace, which has historically resulted in non-deterministic behavior where a different Wallet Provider is connected for each page session.

### Event names

Event names are written in present tense in accordance with JavaScript conventions, and are prefixed with the number of this document (`eip6963:`) to avoid namespace collisions.

### Interfaces

Standardizing `Eip6963ProviderInfo`, an interface for Wallet Provider information, enables Dapps to collect icons, names and other information necessary to programatically generate a user-friendly wallet selection flow (or employ a Wallet Provider Discovery Library such as Web3Modal, RainbowKit, Web3-Onboard, or ConnectKit to do so on its behalf).

When designing the `Eip6963ProviderDetail` interface for Wallet Providers to annouce their presence, it was important to leave the [EIP-1193][EIP-1193] provider interface untouched for backwards compatibility; this allows EIP-6963 conformant Dapps to interface with Wallet Providers conforming to either [EIP-1193][EIP-1193] or EIP-6963, and for EIP-6963 conformant Wallet Providers to inject [EIP-1193][EIP-1193] Provider Objects for legacy Dapps. Note that a legacy Dapp or an EIP-6963 conformant Dapp connecting to a legacy Wallet Provider cannot guarantee the correct Wallet Provider will be selected if multiple are present.

## Backwards Compatibility

EIP-6963 doesn't require Wallet Providers to supplant `window.ethereum`, so it doesn't directly break existing Dapps that cannot update to this method of Wallet Provider discovery. However, it is RECOMMENDED that Dapps implement EIP-6963 to ensure discovery of multiple Wallet Providers and SHOULD disable `window.ethereum` usage except as a fail-over when discovery fails. Similarly, Wallet Providers SHOULD retain the legacy `window.ethereum` behavior to support backward compatibility for Dapps that have not implemented EIP-6963. To prevent namespace collisions, Wallet Providers SHOULD inject their [EIP-1193][EIP-1193] Provider Object under a wallet-specific namespace, then proxy the object into the `window.ethereum` namespace.

## Reference Implementation

### Wallet Provider

Here is a reference implementation of an injected content script from a Wallet Provider that supports the EIP-6963 interface in parallel with the existing legacy pattern (injecting an [EIP-1193][EIP-1193] Provider Object at `window.ethereum`).

```typescript
function onPageLoad() {
  let provider: Eip1193Provider;

  window.ethereum = provider;

  function announceProvider() {
    const info: Eip6963ProviderInfo = {
      uuid: "350670db-19fa-6963-a166-e52e178b59d2",
      name: "Example Wallet",
      icon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'/>",
      rdns: "com.example.wallet"
    };

    window.dispatchEvent(
      new CustomEvent("eip6963:announceProvider", {
        detail: Object.freeze({ info, provider }),
      })
    );
  }

  window.addEventListener(
    "eip6963:requestProvider",
    (event: Eip6963RequestProviderEvent) => {
      announceProvider();
    }
  );

  announceProvider();
}
```

### Dapp / Wallet Provider Discovery Library

Here is a reference implementation of a Dapp or Wallet Provider Discovery Library that keeps track of EIP-6963 compliant Wallet Provider objects announced by their respective browser extensions.

```typescript
const providers: Eip6963ProviderDetail[];

function onPageLoad() {
  window.addEventListener(
    "eip6963:announceProvider",
    (event: Eip6963AnnounceProviderEvent) => {
      providers.push(event.detail);
    }
  );

  window.dispatchEvent(new Event("eip6963:requestProvider"));
}
```

## Security Considerations

### [EIP-1193][EIP-1193] security considerations

The security considerations of [EIP-1193][EIP-1193] apply to EIP-6963. Implementers are expected to consider and follow the guidance of the providers they're utilizing as well.

### Pollution of [EIP-1193][EIP-1193] Provider Objects

Browser extensions, and therefore Wallet Provider extensions, are able to modify the contents of the page and the [EIP-1193][EIP-1193] Provider Object by design. The [EIP-1193][EIP-1193] Provider Objects of various Wallet Providers are considered a highly trusted interface to communicate transaction data. In order to prevent the page or other browser extensions from modifying the interactions between the Dapp and the Wallet Providers in an unexpected way, the best practice is to "freeze" the provider discovery object by utilizing `Object.freeze()` on the `Eip1193Provider` object before the Wallet Provider dispatches it via the `eip6963:announceProvider` event. However, this can hinder compatibility in scenarios where pages need to monkey-patch the object. Implementers of Wallet Providers are expected to consider the potential tradeoffs between security and backward compatibility.

### Wallet Provider imitation and manipulation

Similarly, Dapps and Wallet Provider Discovery Libraries are expected to actively detect when information announced by a Wallet Provider has been modified or tampered with, and consider implementing additional mitigation techniques in order to protect the user. For example, if two `Eip6963ProviderInfo` objects are found to have a matching `uuid` property, the client may choose to ignore both and prevent all user interactions.

### JavaScript execution in SVG images

The use of SVG images introduces a cross-site scripting risk as they can include JavaScript code. This JavaScript executes within the context of the page and can therefore modify the page or the contents of the page. When rendering the icons, Dapps must account for the potential of SVG images being used to obfuscate malicious modifications to the page or to other Wallet Providers.

### Wallet fingerprinting

One advantage of EIP-6963's event-driven concurrency loop over [EIP-1193][EIP-1193] is that either the Dapp or the Wallet Provider can initiate the Wallet Provider discovery flow. For this reason, implementers of Wallet Providers can now consider whether or not they wish to announce themselves to all pages or use alternative means that reduce the potential for a user to be fingerprinted. For example, the Wallet Provider could wait to inject its [EIP-1193][EIP-1193] Provider Object to `window.ethereum` until the `eip6963:requestProvider` event is emitted from the Dapp. At that point, the Wallet Provider can initiate a UI consent flow to ask the user if they would like to share their wallet address. This allows for wallet connection flows that are fully driven by user consent at every step. However, Wallet Providers implementing this approach may not be backward-compatible with Dapps that do not support EIP-6963.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).


[EIP-1193]: ./eip-1193.md
[EIP-6963]: ./eip-6963.md
[RFC-1034]: https://www.rfc-editor.org/rfc/rfc1034
[RFC-2119]: https://www.rfc-editor.org/rfc/rfc2119
[RFC-2397]: https://www.rfc-editor.org/rfc/rfc2397
[RFC-3986]: https://www.rfc-editor.org/rfc/rfc3986
[RFC-4122]: https://www.rfc-editor.org/rfc/rfc4122
