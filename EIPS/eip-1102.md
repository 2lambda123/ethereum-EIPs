---
eip: 1102
title: Opt-in provider access
author: Paul Bouchon <mail@bitpshr.net>
discussions-to: https://ethereum-magicians.org/t/eip-1102-opt-in-provider-access/414
status: Draft
type: Standards Track
category: Interface
created: 2018-05-04
---

## Simple summary

This proposal describes a way for DOM environments to expose an Ethereum provider that requires user approval.

## Abstract

The previous generation of Ethereum-enabled DOM environments follows a pattern of injecting a fully-capable provider into the DOM without user consent. This puts users of such envrionments at risk because malicious websites can use this provider to view account information and to arbitrarily initiate unwanted Ethereum transactions on a user's behalf.

This proposal outlines a protocol in which DOM environments expose a read-only provider until full provider access is approved by the user.

## Specification

### Definitions

1. **Read-only provider**

    A read-only provider has no populated accounts and ignores any RPC call requiring an account.

2. **Full provider**

    A full provider may have populated accounts and does not ignore any RPC calls.


### Protocol

DOM environments expose a read-only provider globally at `window.ethereum` by default. If a dapp requests full provider access and the user approves, the provider at `window.ethereum` is fully-enabled and the dapp is notified. If the user denies full provider access, the provider at `window.ethereum` is left unchanged and the dapp is notified with an error.

#### Typical dapp initialization

```
START dapp
IF web3 is defined
    CONTINUE dapp
IF web3 is undefined
    STOP dapp
```

#### Proposed dapp initialization

```
START dapp
IF provider is defined
    REQUEST[1] full provider
    IF user approves
        ENABLE[2] full provider
        RESPOND[3] with success
        CONTINUE dapp
    IF user denies
        RESPOND[4] with error
        STOP dapp
IF provider is undefined
    STOP dapp
```

##### `[1] REQUEST`

Dapps MUST request a full provider by sending a message using the [`window.postMessage`](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage) API. This message MUST be sent with a payload object containing a `type` property with a value of "ETHEREUM_ENABLE_PROVIDER".

##### `[2] ENABLE`

If a user approves full provider access, DOM environments MUST expose a fully-capable provider at `window.ethereum`.

##### `[3] RESPOND (SUCCESS)`

If a user approves full provider access, DOM environments MUST respond by emitting an "ethereumprovider" [CustomEvent](https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent) on the `window` object.

##### `[4] RESPOND (ERROR)`

If a user denies full provider access, DOM environments MUST respond by emitting an "ethereumprovider" [CustomEvent](https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent) on the `window` object. This custom event MUST pass an `error` property corresponding to an informative Error object on its `detail` data object.

### Example initialization

```js
window.addEventListener('load', async () => {
    // Read-only provider is exposed by default
    console.log(await ethereum.send('net_version'));
    // Listen for full provider response if needed
    window.addEventListener('ethereumprovider', async ({ detail: { error } }) => {
        if (error) {
            // User denied full provider access
        } else {
            // Full provider exposed
            await ethereum.send('eth_sendTransaction', [/* ... */]);
        }
    });
    // Request full provider if needed
    window.postMessage({ type: 'ETHEREUM_ENABLE_PROVIDER' }, '*');
});
```

### Constraints

* Browsers MUST expose a read-only provider at `window.ethereum` by default.
* Browsers MUST NOT expose a full provider globally by default.
* Dapps MUST request access to a full provider.
* Users MUST be able to approve or deny full provider access.
* A full provider MUST be exposed at `window.ethereum` after user approval.
* Dapps MUST be notified of user denial.

## Rationale

The pattern of full provider auto-injection followed by the previous generation of Ethereum-enabled DOM environments fails to protect user privacy and fails to maintain safe user experience: untrusted websites can both view account information and abritrarily initiate transactions on a user's behalf. Even though most users may reject unsolicited transactions on untrusted websites, a protocol for provider exposure should make such unsolicited requests impossible.

This proposal establishes a new pattern wherein dapps must request access to a full Ethereum provider. This protocol directly strengthens user privacy by hiding user accounts and preventing unsolicited transaction requests on untrusted sites.

### Immediate value-add

* Users can reject full provider access on untrusted sites to hide accounts.
* Users can reject full provider access on untrusted sites to prevent unsolicited transactions.

### Long-term value-add

* Dapps could request specific account information based on user consent.
* Dapps could request specific user information based on user consent (uPort, DIDs).
* Dapps could request a specific network based on user consent.
* Dapps could request multiple instances of the above based on user consent.

## Backwards compatibility

This proposal impacts dapp authors and requires that they request access to a full Ethereum provider before using it to initiate any RPC call that requires an account. This proposal also impacts developers of Ethereum-enabled DOM environments or dapp browsers as these tools should no longer auto-expose a full provider; instead, they should expose a read-only provider and only expose a full provider if a website requests one and a user consents to its access.

## Implementation

The MetaMask team is currently working an [MVP implementation](https://github.com/MetaMask/metamask-extension/pull/4703) of the strategy described above and expects to begin limited user testing soon.

## Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
